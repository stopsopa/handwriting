<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="preload" href="docs/writer.gif" as="image" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <script
      src="https://cdn.jsdelivr.net/gh/MarketingPipeline/GitHub-Ribbon-Web-Component/dist/github-ribbon-wc.min.js"
      defer
    ></script>
    <div id="hide">
      <h1>Handwriting Practice Sheet Generator</h1>

      <div>
        <label for="char-limit">Character Limit per Line:</label>
        <input type="number" id="char-limit" value="68" />
      </div>
      <div>
        Lines:
        <label>
          <input type="radio" name="lines" value="two" checked /> two lines
        </label>
        <label> <input type="radio" name="lines" value="line1_3" /> 1/2 </label>
        <label> <input type="radio" name="lines" value="line2_3" /> 2/3 </label>
      </div>
      <br />
      <textarea
        id="text-input"
        rows="10"
        cols="120"
        placeholder="Paste your text here..."
      >
Then He spoke a parable to them, that men always ought to pray and not lose heart, saying: There was in a certain city a judge who did not fear God nor regard man. Now there was a widow in that city; and she came to him, saying, Get justice for me from my adversary. And he would not for a while; but afterward he said within himself, Though I do not fear God nor regard man, yet because this widow troubles me I will avenge her, lest by her continual coming she weary me.  Then the Lord said, Hear what the unjust judge said. And shall God not avenge His own elect who cry out day and night to Him, though He bears long with them? I tell you that He will avenge them speedily. Nevertheless, when the Son of Man comes, will He really find faith on the earth? </textarea
      ><br />
      <button id="print-button">Print Page</button>
      <button id="printing-tip-button">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          fill="currentColor"
          class="bi bi-question-circle"
          viewBox="0 0 16 16"
        >
          <path
            d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"
          />
          <path
            d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"
          />
        </svg>
        Printing tip
      </button>

      <h2>Preview</h2>
    </div>
    <div id="preview-area" class="preview"></div>

    <div id="printing-tip-modal" class="modal">
      <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2>Printing tip</h2>
        <p>
          Browsers don’t give full control over where page breaks occur when
          printing. Because of this, a line of text and its corresponding
          practice space (the blank area with guiding lines) may sometimes be
          split across two pages — which is not ideal for handwriting exercises.
        </p>
        <p>
          To work around this, you can manually adjust the zoom level in the
          print dialog (e.g., Chrome’s print preview). Changing the zoom
          slightly can shift the content so that each text line stays together
          with its practice space on the same page.
        </p>
        <p>
          The GIF below demonstrates how to adjust the zoom and find a setting
          that keeps the text and its corresponding practice line together.
        </p>
        <img src="docs/writer.gif" alt="Print page break tip" />
      </div>
    </div>

    <github-ribbon
      link="https://github.com/stopsopa/handwriting"
      type="right"
      color="#679d2c"
      >Fork me on GitHub</github-ribbon
    >

    <script type="module">
      import smartLineBreak from "./smartLineBreak.js";

      const textInput = document.getElementById("text-input");
      const charLimitInput = document.getElementById("char-limit");

      const linesSelector = 'input[type="radio"][name="lines"]';
      const linesElementsList = [...document.querySelectorAll(linesSelector)];

      const previewArea = document.getElementById("preview-area");
      const printButton = document.getElementById("print-button");

      printButton.addEventListener("click", () => {
        window.print();
      });

      let i = 0;
      function updatePreview() {
        i += 1;
        console.log("render", i);

        const text = textInput.value;
        const limit = parseInt(charLimitInput.value, 10);

        const lines = smartLineBreak(text, limit);

        previewArea.innerHTML = "";

        {
          linesElementsList.forEach((e) => {
            previewArea.classList.remove(e.value);
          });

          // class radio driven
          const threeLines = document.querySelector(
            `${linesSelector}:checked`
          ).value;

          previewArea.classList.add(threeLines);
        }

        for (let line of lines) {
          const div = document.createElement("div");

          div.innerText = line;

          div.classList.add("line");

          previewArea.appendChild(div);
        }
      }

      textInput.addEventListener("input", updatePreview);
      charLimitInput.addEventListener("input", updatePreview);

      document.addEventListener("click", (e) => {
        const target = e.target;

        var match = target.matches(linesSelector);

        if (match) {
          updatePreview();
        }
      });

      // Initial preview update
      updatePreview();

      {
        // modal

        const modal = document.getElementById("printing-tip-modal");
        const btn = document.getElementById("printing-tip-button");
        const span = document.getElementsByClassName("close-button")[0];

        btn.addEventListener("click", () => {
          modal.style.display = "block";
        });

        span.addEventListener("click", () => {
          modal.style.display = "none";
        });

        window.addEventListener("click", (event) => {
          if (event.target == modal) {
            modal.style.display = "none";
          }
        });
      }
    </script>
  </body>
</html>
